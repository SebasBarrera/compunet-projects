package co.edu.icesi.fi.ci.junit5exercise.test;

import static org.junit.jupiter.api.Assertions.assertAll;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.util.Date;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import co.edu.icesi.fi.ci.junit5exercise.main.AppConfig;
import co.edu.icesi.fi.ci.junit5exercise.model.Order;
import co.edu.icesi.fi.ci.junit5exercise.service.OrderService;

@ContextConfiguration(classes = { AppConfig.class })
@ExtendWith(value = { SpringExtension.class }) 
class JUnitSpringTests {
	
	private static OrderService os;
	private static Order o;
	
	@Autowired
	public JUnitSpringTests(OrderService os) {
		JUnitSpringTests.os = os;
	}

	@BeforeAll
	public static void setUp() {
		System.out.println("-----> SETUP <-----");
		o = new Order(123456, "INITIATED", "ABCD", "yes, this is a description", new Date());
		//os.createOrder(o);
	}

	@Test
	@DisplayName("Descripcion empieza con 'Description:'")
	public void testSampleServiceGetAccountDescription() {
		// Check if the return description has a 'Description:' string.
		assertTrue(os.getOrderDescription(o.orderId).substring(0, 12).contains("Description:"));
	}

	@Test
	@DisplayName("Metodo para obtener codigos empieza con 'Acoount Code:'")
	public void testSampleServiceGetAccountCode() {
		assertTrue(os.getOrderStringCode(o.orderId).substring(0, 13).contains("Account Code:"));
	}
	
	@Test
	@DisplayName("Creacion de metodos correcta")
	public void testSampleServiceCreateOder() {
		Order to = os.createOrder(o);
		to.setDescription("is not null");
		
		assertAll("crear",
				() -> assertNotNull(to.getDescription()),
				() -> assertEquals("XYZ", to.getSecurityCode()),
				() -> assertTrue(to.getOrderDate() instanceof Date),
				() -> assertEquals("INITIATED", to.getOrderStatus()),
				() -> assertNotNull(to.getOrderId())
				);
	}
	
	@Test
	@DisplayName("ObtenciÃ³n de metodos correcta")
	public void testSampleServiceGetOder() {
		Order to = os.getOrder(12368486);
		assertAll("obtener",
				() -> assertEquals("This is the new XYZ order", to.getDescription()),
				() -> assertEquals("XYZ", to.getSecurityCode()),
				() -> assertTrue(to.getOrderDate() instanceof Date),
				() -> assertEquals("COMPLETED", to.getOrderStatus()),
				() -> assertNotNull(to.getOrderId())
				);
	}
	
	

	@AfterAll
	private static void afterTest() {
		System.out.println("-----> DESTROY <-----");
	}
}
